

/**
 * Module dependencies.
 */
 
var express = require('express')
, jsdom = require('jsdom')
, request = require('request')
, redis = require('redis')
, db = redis.createClient()
, url = require('url');

var app = express();

app.use(function(req, res, next){
  var ua = req.headers['user-agent'];
  db.zadd('online', Date.now(), ua, next);
});


app.use(function(req, res, next){
  var min = 60 * 1000;
  var ago = Date.now() - min;
  db.zrevrangebyscore('online', '+inf', ago, function(err, users){
    if (err) return next(err);
    req.online = users;
    next();
  });
});


app.get('/', function(req, res){
  res.send(req.online.length + ' users online');
  jsdom.jQueryify(app, "jquery.js", function() {
  app.jQuery("body").append("<div class='testing'>Hello World, It works!</div>");
  console.log('insie')
  console.log(app.jQuery(".testing").text());
});    
});



app.listen(3000); 


/** jquery */

var jsdom = require("jsdom").jsdom;
var window = jsdom().parentWindow;

window.__myObject = { foo: "bar" };

var scriptEl = window.document.createElement("script");
scriptEl.src = "anotherScript.js";
window.document.body.appendChild(scriptEl);   


















 




<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.d2{
top:10px;
}

#heatmap2{
height:150px;
}

.axis { 
  fill: none; 
  stroke: black; 
  stroke-width; 1; 
} 

.label {
  stroke: #222;
  fill:none; 
  stroke-width; 1; 
} 

.text {
	top:20px;
  stroke-width; 1;
}


</style>
<body>
<div id='head'></div>
<div id='heatmap2'></div>
<div id='heatmap'></div>


<script src="js/d3.min.js"></script>
<script>

var user = 'xxx';

d3.tsv("data/perception-heatmap.tsv", function(error, data) {

	data.forEach(function(d) {
		user = d.user;
  });
  
	
	var gridSize = 5,
    h = 20,
    w = 1,
    rectPadding = 10;
		var scaleF = 0.5;
		
		var colorLow = 'lightgreen', colorMed = 'yellow', colorHigh = 'red';

		var margin = {top: 0, right: 10, bottom: 30, left: 100},
				margin2 = {top: 0, right: 10, bottom: 30, left: 100},
				width = 1200 - margin.left - margin.right,
				height = 420 - margin.top - margin.bottom;

		// colors
		var colorScale = d3.scale.linear().domain([1, 3, 7]).range([colorLow, colorMed, colorHigh]); 
		var color = d3.scale.category10();		 




		// second heatmap
		var svg = d3.select("#heatmap").append("svg")
				.attr('class','d2')
				.attr("width", width)
				.attr("height", height)
				.append("g")
				.attr("transform", "translate(" + margin2.left + ", 0)");


		// add annotations to heatmap
		d3.tsv("annotation_distribution.tsv", function(error, anno) {
			var heatMap = svg.selectAll("#heatmap")
				.data(anno, function(d) { 
					return d.time; })	
				.enter().append("svg:rect")
					.attr("x", function(d) { return d.time * w* scaleF })
					.attr("y", function(d) { return 120; })
					.attr("width", function(d) { return 2; })
					.attr("height", function(d) { return 25; })
					.style("fill", function(d) { return color(d.type); });;
		});

		var heatMap = svg.selectAll("#heatmap")
				.data(data, function(d) { 
					return d.col + ':' + d.row; })
						.enter().append("svg:rect")
							.attr("x", function(d) { return d.col * w * scaleF; })
							.attr("y", function(d) { return 120 - d.score * 10 ; })
							.attr("width", function(d) { return w; })
							.attr("height", function(d) { return  d.score * 10 ; });
//							.style("fill", function(d) { return colorScale(d.score); });

// axis
	
	var maxY = d3.max(data, function(d) { return +d.score;} );
	var maxX = d3.max(data, function(d) { return +d.col;} );
  
  var y = d3.scale.linear().range([maxY,0 ]);
	var x = d3.scale.linear().range([0, maxX/3.15 ]);
  var yAxis = d3.svg.axis().scale(y).orient("left").tickValues([1, 3, 5, 7, 9, 11]);
//    .innerTickSize(20);
	var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(5);
	
	 y.domain(d3.extent(data, function(d) { return d.score/10; })).nice();
	 x.domain(d3.extent(data, function(d) { return d.col/60; })).nice();
	  
	  var axisY = svg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(0,84)")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("x", 100)
      .attr("y", 10)
      .attr("dy", ".1em")
      .style("text-anchor", "end")
     	.text("Aufrufe")
     
    var axisX =	svg.append("g")
		    .attr("class", "x axis")
		    .attr("transform", "translate(0,120)")
		    .call(xAxis)
		  .append("text")
		    .attr("class", "label")
		    .attr("x", maxX/3 - 20)
		    .attr("y", -25)
		    .style("text-anchor", "end")
		    .text("Abspielposition im Video / min");

		// headline
		 var text = svg.append("text")
		     .attr("x", 100)
		     .attr("y", 0)
		    // .text( 'User: '+ user.length)
		     .attr("font-family", "Arial")
		     .attr("font-size", "20px")
		     .attr("fill", "#333");   





		var heatMap = svg.selectAll("#heatmap")
				.data(data, function(d) { 
					return d.col + ':' + d.row; })
						.enter().append("svg:rect")
							.attr("x", function(d) { return d.col * w * scaleF; })
							.attr("y", function(d) { return d.row * h +124; })
							.attr("width", function(d) { return w; })
							.attr("height", function(d) { return h; })
							.style("fill", function(d) { return d.score > 0 ? colorScale(d.score) : 'white'; });

		 var legend = svg.selectAll(".legend")
		    .data(colorScale.domain())
		  	.enter().append("g")
		    .attr("class", "legend")
		    .attr("transform", function(d, i) { return "translate(" + i * 20 + ",120)"; });

		legend.append("rect")
		    .attr("x", 800)
		    .attr("y", 55)
		    .attr("width", 18)
		    .attr("height", 18)
		    .style("fill", colorScale);

		legend.append("text")
		    .attr("x", 804)
		    .attr("y", 64)
		    .attr("dy", ".35em")
		    .style("text-anchor", "start")
		    .text(function(d) { return d; });
		    
	
	





});



//height of each row in the heatmap
//width of each column in the heatmap





</script>
